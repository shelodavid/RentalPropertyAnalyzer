@model RentalPropertyAnalyzer.Models.PurchaseSheetViewModel

@{
    ViewData["Title"] = "Purchase Sheet";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@*
    Wrap everything in a form that POSTs to a desired action
    (e.g., "CalculatePurchaseSheet") on a "PurchaseSheet" controller.
    Update these names to match your actual controller/action.
*@
@section SlidersSection
{
    <div class="container-fluid">
        <div class="row">
            <!-- COLUMN 1: 4 Sliders -->
            <div class="col-md-4">
                <!-- Slider 1: Downpayment Percentage -->
                <div class="mb-3">
                    <label asp-for="DownpaymentPercentage">Downpayment Percentage</label>
                    <input type="range"
                           asp-for="DownpaymentPercentage"
                           min="0" max="100" step="0.1"
                           class="form-range"
                           form="purchaseSheetForm"
                           oninput="this.nextElementSibling.value = parseFloat(this.value).toFixed(2)" />
                    <output>@Model.DownpaymentPercentage.ToString("F2")</output>
                </div>

                <!-- Slider 2: Mortgage Interest Rate -->
                <div class="mb-3">
                    <label asp-for="MortgageInterestRate">Mortgage Interest Rate (%)</label>
                    <input type="range"
                           asp-for="MortgageInterestRate"
                           min="0" max="20" step="0.1"
                           class="form-range"
                           form="purchaseSheetForm"
                           oninput="this.nextElementSibling.value = parseFloat(this.value).toFixed(2)" />
                    <output>@Model.MortgageInterestRate.ToString("F2")</output>
                </div>

                <!-- Slider 3: Term -->
                <div class="mb-3">
                    <label asp-for="Term">Mortgage Term (Years)</label>
                    <input type="range"
                           asp-for="Term"
                           min="0" max="30" step="1"
                           class="form-range"
                           form="purchaseSheetForm"
                           oninput="this.nextElementSibling.value = this.value" />
                    <output>@Model.Term</output>
                </div>

                <!-- Slider 4: Loan Origination Fee -->
                <div class="mb-3">
                    <label asp-for="LoanOriginationFee">Loan Origination Fee</label>
                    <input type="range"
                           asp-for="LoanOriginationFee"
                           min="0" max="100" step="0.1"
                           class="form-range"
                           form="purchaseSheetForm"
                           oninput="this.nextElementSibling.value = this.value" />
                    <output>@Model.LoanOriginationFee</output>
                </div>
            </div>
            <!-- END COLUMN 1 -->
            <!-- COLUMN 2: 4 Sliders -->
            <div class="col-md-4">
                <!-- Slider 5: Appraisal Fee -->
                <div class="mb-3">
                    <label asp-for="AppraisalFee">Appraisal Fee</label>
                    <input type="range"
                           asp-for="AppraisalFee"
                           min="0" max="5000" step="50"
                           class="form-range"
                           form="purchaseSheetForm"
                           oninput="this.nextElementSibling.value = this.value" />
                    <output>@Model.AppraisalFee</output>
                </div>

                <!-- Slider 6: Credit Report Fee -->
                <div class="mb-3">
                    <label asp-for="CreditReportFee">Credit Report Fee</label>
                    <input type="range"
                           asp-for="CreditReportFee"
                           min="0" max="500" step="10"
                           class="form-range"
                           form="purchaseSheetForm"
                           oninput="this.nextElementSibling.value = this.value" />
                    <output>@Model.CreditReportFee</output>
                </div>

                <!-- Slider 7: Title Insurance Cost -->
                <div class="mb-3">
                    <label asp-for="TitleInsuranceCost">Title Insurance Cost</label>
                    <input type="range"
                           asp-for="TitleInsuranceCost"
                           min="0" max="3000" step="50"
                           class="form-range"
                           form="purchaseSheetForm"
                           oninput="this.nextElementSibling.value = this.value" />
                    <output>@Model.TitleInsuranceCost</output>
                </div>

                <!-- Slider 8: Title Search Fee -->
                <div class="mb-3">
                    <label asp-for="TitleSearchFee">Title Search Fee</label>
                    <input type="range"
                           asp-for="TitleSearchFee"
                           min="0" max="1000" step="25"
                           class="form-range"
                           form="purchaseSheetForm"
                           oninput="this.nextElementSibling.value = this.value" />
                    <output>@Model.TitleSearchFee</output>
                </div>
            </div>
            <!-- END COLUMN 2 -->
            <!-- COLUMN 3: 3 Sliders -->
            <div class="col-md-4">
                <!-- Slider 9: Escrow Fee -->
                <div class="mb-3">
                    <label asp-for="EscrowFee">Escrow Fee</label>
                    <input type="range"
                           asp-for="EscrowFee"
                           min="0" max="5000" step="50"
                           class="form-range"
                           form="purchaseSheetForm"
                           oninput="this.nextElementSibling.value = this.value" />
                    <output>@Model.EscrowFee</output>
                </div>

                <!-- Slider 10: Flood Inspection Fee -->
                <div class="mb-3">
                    <label asp-for="FloodInspectionFee">Flood Inspection Fee</label>
                    <input type="range"
                           asp-for="FloodInspectionFee"
                           min="0" max="1000" step="25"
                           class="form-range"
                           form="purchaseSheetForm"
                           oninput="this.nextElementSibling.value = this.value" />
                    <output>@Model.FloodInspectionFee</output>
                </div>

                <!-- Slider 11: Miscellaneous Fees -->
                <div class="mb-3">
                    <label asp-for="MiscellaneousFees">Miscellaneous Fees</label>
                    <input type="range"
                           asp-for="MiscellaneousFees"
                           min="0" max="5000" step="50"
                           class="form-range"
                           form="purchaseSheetForm"
                           oninput="this.nextElementSibling.value = this.value" />
                    <output>@Model.MiscellaneousFees</output>
                </div>
            </div>
            <!-- END COLUMN 3 -->
        </div>
    </div>
}

@using (Html.BeginForm("GeneratePurchaseSheet", "Home", FormMethod.Post, new { id = "purchaseSheetForm" }))
{
    @Html.HiddenFor(model => model.ZipID)
    @Html.HiddenFor(model => model.InvestmentProfileID)
    @Html.HiddenFor(model => model.StreetAddress)
    @Html.HiddenFor(model => model.PropertyType)
    @Html.HiddenFor(model => model.Bathrooms)
    @Html.HiddenFor(model => model.Bedrooms)
    @Html.HiddenFor(model => model.ImgSrc)
    @Html.HiddenFor(model => model.Price)
    @Html.HiddenFor(model => model.TaxAssessedValue)
    @Html.HiddenFor(model => model.Downpayment)
    @Html.HiddenFor(model => model.MortgageAmount)
    @Html.HiddenFor(model => model.LoanClosingCosts)
    @Html.HiddenFor(model => model.RealtorsCost)
    @Html.HiddenFor(model => model.EstimatedMortgageCost)
    @Html.HiddenFor(model => model.EstimatedInsuranceCost)


    <!--
        Below is the rest of the page content.
        These references won't compile unless you add them to
        InvestmentProfile or create a combined ViewModel that has them.
    -->
    @await Html.PartialAsync("Partials/_PageHeader", ("Purchase Sheet", "Review purchase details and closing costs", (Microsoft.AspNetCore.Html.IHtmlContent?)null), viewData: null)

    <div class="row g-4 mb-4">
        <!-- Property Image -->
        <div class="col-md-3">
            <!-- 'ImgSrc' is not in InvestmentProfile by default -->
            <img src="@Model.ImgSrc" alt="Property Image" class="property-image">
        </div>

        <!-- Property Information -->
        <div class="col-md-4">
            <!-- 'StreetAddress', 'PropertyType', 'Bedrooms', etc. are not in InvestmentProfile -->
            <p class="mb-1"><strong>Address:</strong> @Model.StreetAddress</p>
            <p class="mb-1"><strong>Property Type:</strong> @Model.PropertyType</p>
            <p class="mb-1"><strong>Bedrooms 🛏️ :</strong> @Model.Bedrooms </p>
            <p class="mb-0"><strong>Bathrooms 🛁 :</strong> @Model.Bathrooms </p>
        </div>

        <div class="col-md-4">
            <!-- 'Price' does not exist in InvestmentProfile by default -->
            <p class="mb-1"><strong>Price:</strong> @Model.Price.ToString("C")</p>
            <p class="mb-1"><strong>Interest Rate:</strong> @Model.MortgageInterestRate %</p>
            <p class="mb-1"><strong>Mortgage Term (Years):</strong> @Model.Term</p>
            <p class="mb-1"><strong>Downpayment Percentage:</strong> @Model.DownpaymentPercentage %</p>
            <!-- 'TaxAssessedValue' also not in InvestmentProfile by default -->
            <p class="mb-0"><strong>Tax Assessed Value:</strong> @Model.TaxAssessedValue.ToString("C")</p>
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-md-12">
            <h3 class="h5 mb-3">Itemized Closing Costs</h3>
            <table class="table table-striped table-hover align-middle table-app costs-table">
                <thead>
                    <tr>
                        <th>Item</th>
                        <th></th>
                        <th rowspan="2" class="text-center">Amount (USD)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Purchase Price</td>
                        <td></td>
                        <td class="text-center">@Model.Price.ToString("C")</td>
                    </tr>
                    <tr>
                        <td>Less Downpayment</td>
                        <!-- 'Downpayment' property is not in InvestmentProfile by default -->
                        <td class="text-center">@Model.Downpayment.ToString("C")</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>Mortgage Amount</td>
                        <td></td>
                        <td class="text-center">@Model.MortgageAmount.ToString("C")</td>
                    </tr>

                    <tr class="total-row">
                        <td class="text-dark">Fees and Other Closing Costs</td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>Home Appraisal Fee</td>
                        <td class="text-center">@Model.AppraisalFee.ToString("C")</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>Escrow Fee</td>
                        <td class="text-center">@Model.EscrowFee.ToString("C")</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>Flood Inspection Fee</td>
                        <td class="text-center">@Model.FloodInspectionFee.ToString("C")</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>Loan Origination Fee</td>
                        <td class="text-center">@Model.LoanOriginationFee.ToString("C")</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>Title Inspection Fee</td>
                        <td class="text-center">@Model.TitleInsuranceCost.ToString("C")</td>
                        <td></td>
                    </tr>

                    <tr class="total-row">
                        <td class="text-dark">Prepaids &amp; Escrow</td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>Prepaid Interest (@Model.PrepaidInterestDays days)</td>
                        <td class="text-center">@Model.PrepaidInterestAmount.ToString("C")</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>Escrow Seed (Taxes @Model.EscrowMonthsTaxes mo.)</td>
                        <td class="text-center">@((Model.EstimatedMonthlyPropertyTaxes * Model.EscrowMonthsTaxes).ToString("C"))</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>Escrow Seed (Insurance @Model.EscrowMonthsInsurance mo.)</td>
                        <td class="text-center">@((Model.AnnualHomeownersInsurance / 12m * Model.EscrowMonthsInsurance).ToString("C"))</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>Prepaids Total</td>
                        <td class="text-center">@Model.TotalPrepaids.ToString("C")</td>
                        <td></td>
                    </tr>

                    <tr class="total-row">
                        <td class="text-dark">Government Fees</td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>Recording Fees</td>
                        <td class="text-center">@Model.RecordingFees.ToString("C")</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>Transfer Taxes</td>
                        <td class="text-center">@Model.TransferTaxes.ToString("C")</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>Government Fees Total</td>
                        <td class="text-center">@Model.TotalGovernmentFees.ToString("C")</td>
                        <td></td>
                    </tr>

                    <!-- 'TotalCost' not in InvestmentProfile by default -->
                    <tr class="total-row">
                        <td>Cash to Close</td>
                        <td class="text-center">@Model.TotalCost.ToString("C")</td>
                        <td></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-lg-6">
            <div class="card shadow-sm">
                <div class="card-header bg-white">
                    <h3 class="h6 mb-0">Prepaids &amp; Escrow Inputs</h3>
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label" for="PrepaidInterestDays">Prepaid Interest Days</label>
                            <input class="form-control" type="number" name="PrepaidInterestDays" value="@Model.PrepaidInterestDays" min="0" />
                        </div>
                        <div class="col-md-6">
                            <label class="form-label" for="AnnualHomeownersInsurance">Annual Homeowners Insurance</label>
                            <input class="form-control" type="number" step="0.01" name="AnnualHomeownersInsurance" value="@Model.AnnualHomeownersInsurance" min="0" />
                        </div>
                        <div class="col-md-6">
                            <label class="form-label" for="EscrowMonthsTaxes">Escrow Months (Taxes)</label>
                            <input class="form-control" type="number" name="EscrowMonthsTaxes" value="@Model.EscrowMonthsTaxes" min="0" />
                        </div>
                        <div class="col-md-6">
                            <label class="form-label" for="EscrowMonthsInsurance">Escrow Months (Insurance)</label>
                            <input class="form-control" type="number" name="EscrowMonthsInsurance" value="@Model.EscrowMonthsInsurance" min="0" />
                        </div>
                        <div class="col-12">
                            <label class="form-label" for="PropertyTaxRatePercent">Property Tax Rate (%)</label>
                            <input class="form-control" type="number" step="0.01" name="PropertyTaxRatePercent" value="@Model.PropertyTaxRatePercent" min="0" />
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-6">
            <div class="card shadow-sm">
                <div class="card-header bg-white">
                    <h3 class="h6 mb-0">Government Fees</h3>
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label" for="RecordingFees">Recording Fees</label>
                            <input class="form-control" type="number" step="0.01" name="RecordingFees" value="@Model.RecordingFees" min="0" />
                        </div>
                        <div class="col-md-6">
                            <label class="form-label" for="TransferTaxes">Transfer Taxes</label>
                            <input class="form-control" type="number" step="0.01" name="TransferTaxes" value="@Model.TransferTaxes" min="0" />
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="d-flex flex-wrap gap-2">
        <button type="submit" class="btn btn-primary">Recalculate</button>
        <a href="@Url.Action("Index", "Home")" class="btn btn-secondary">Back to Home</a>
    </div>
}
